<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>HLS Overlay Player</title>

<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>


</head>

<body>


  <div class="video-container">
    

    <!-- ✅ autoplay + muted au niveau HTML -->
    <video
      id="video"
      controls
      width="100%" 
      height="100%"
      playsinline
      autoplay
      muted
      poster="https://upload.wikimedia.org/wikipedia/commons/thumb/0/00/CNN_Portugal.svg/300px-CNN_Portugal.svg.png"
    ></video>
  </div>


<script>
  const video = document.getElementById('video');
  const streamUrl = "https://video-auth6.iol.pt/live_cnn/live_cnn/playlist.m3u8?wmsAuthSign=c2VydmVyX3RpbWU9Mi8xMS8yMDI2IDY6MTY6MjMgQU0maGFzaF92YWx1ZT1qUHV2N2xiRUpMbWk1YVpuUUN2T2d3PT0mdmFsaWRtaW51dGVzPTE0NDAmaWQ9MmYwMzJjYjUtYzA4ZC00NThhLWEyNDItNjZhMGFlMjE4NDA0";

  // ✅ Forçage JS (certaines plateformes ignorent l'attribut)
  video.muted = false;
  video.autoplay = true;
  video.playsInline = true;

  function tryPlay() {
    const p = video.play();
    if (p && typeof p.catch === "function") p.catch(() => {});
  }

  function initPlayer() {
    if (window.Hls && Hls.isSupported()) {
      const hls = new Hls({
        enableWorker: true,
        lowLatencyMode: true,
        backBufferLength: 90
      });

      hls.loadSource(streamUrl);
      hls.attachMedia(video);

      hls.on(Hls.Events.MEDIA_ATTACHED, () => {
        // ✅ autoplay
        tryPlay();
      });

      // ✅ si blocage, relance au premier geste utilisateur
      document.addEventListener("click", tryPlay, { once: true });

    } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
      video.src = streamUrl;

      video.addEventListener('loadedmetadata', () => {
        // ✅ autoplay
        tryPlay();
      }, { once: true });

      document.addEventListener("click", tryPlay, { once: true });
    }
  }

  function closePlayer() {
    window.parent.postMessage({ action: "closeOverlayPlayer" }, "*");
  }

  initPlayer();
</script>

</body>
</html>
